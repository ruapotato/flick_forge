<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Flick Store - Discover and install Qt/QML apps for Flick mobile shell. Fast, modern, and community-driven.">
  <meta name="theme-color" content="#0a0a0f">
  <title>Flick Store - Qt/QML Apps for Flick</title>
  <link rel="stylesheet" href="/static/css/style.css">
  <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>&#127919;</text></svg>">
</head>
<body>
  <!-- Header -->
  <header class="header">
    <div class="container header-inner">
      <a href="/" class="logo">
        <div class="logo-icon">
          <svg viewBox="0 0 24 24" fill="currentColor">
            <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/>
          </svg>
        </div>
        <span>Flick Store</span>
      </a>

      <nav class="nav" role="navigation" aria-label="Main navigation">
        <a href="/" class="nav-link active">Home</a>
        <a href="/browse" class="nav-link">Browse</a>
        <a href="/wildwest" class="nav-link wild-west">Wild West</a>
        <a href="/request" class="nav-link">Request</a>
      </nav>

      <div class="header-actions">
        <div class="header-search">
          <svg class="header-search-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="11" cy="11" r="8"/>
            <path d="m21 21-4.35-4.35"/>
          </svg>
          <input type="search" placeholder="Search apps..." aria-label="Search apps" data-search>
        </div>

        <a href="/login" class="btn btn-ghost" data-guest>Sign In</a>
        <a href="/profile" class="btn btn-secondary" data-auth style="display:none">
          <span data-user-avatar>U</span>
        </a>
      </div>

      <button class="menu-toggle" aria-label="Toggle menu" aria-expanded="false">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M3 12h18M3 6h18M3 18h18"/>
        </svg>
      </button>
    </div>
  </header>

  <main>
    <!-- Hero Section -->
    <section class="hero">
      <div class="container">
        <h1 class="hero-title">Discover Qt/QML Apps for Flick</h1>
        <p class="hero-subtitle">
          Fast, modern, and community-driven. Find and install apps for your Flick mobile shell.
        </p>
        <div class="hero-search">
          <svg class="hero-search-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="11" cy="11" r="8"/>
            <path d="m21 21-4.35-4.35"/>
          </svg>
          <input type="search" placeholder="Search for apps, games, tools..." aria-label="Search for apps" data-search>
        </div>
      </div>
    </section>

    <!-- Featured Apps -->
    <section class="section">
      <div class="container">
        <div class="section-header">
          <h2 class="section-title">Featured Apps</h2>
          <a href="/browse?featured=true" class="section-link">
            View all
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="m9 18 6-6-6-6"/>
            </svg>
          </a>
        </div>

        <div class="carousel">
          <div class="carousel-track" id="featured-carousel">
            <!-- Featured apps loaded dynamically from API -->
            <div class="loading" id="featured-loading">
              <div class="loading-spinner"></div>
            </div>
          </div>

          <div class="carousel-nav prev">
            <button class="carousel-btn" aria-label="Previous slide">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="m15 18-6-6 6-6"/>
              </svg>
            </button>
          </div>
          <div class="carousel-nav next">
            <button class="carousel-btn" aria-label="Next slide">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="m9 18 6-6-6-6"/>
              </svg>
            </button>
          </div>

          <div class="carousel-dots"></div>
        </div>
      </div>
    </section>

    <!-- Categories -->
    <section class="section">
      <div class="container">
        <div class="section-header">
          <h2 class="section-title">Categories</h2>
          <a href="/browse" class="section-link">
            Browse all
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="m9 18 6-6-6-6"/>
            </svg>
          </a>
        </div>

        <div class="grid grid-categories" id="categories-grid">
          <!-- Categories loaded dynamically from API -->
          <div class="loading" id="categories-loading">
            <div class="loading-spinner"></div>
          </div>
        </div>
      </div>
    </section>

    <!-- Popular Apps -->
    <section class="section">
      <div class="container">
        <div class="section-header">
          <h2 class="section-title">Popular Apps</h2>
          <a href="/browse?sort=popular" class="section-link">
            View all
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="m9 18 6-6-6-6"/>
            </svg>
          </a>
        </div>

        <div class="grid grid-apps" id="popular-apps">
          <div class="loading" id="popular-loading">
            <div class="loading-spinner"></div>
          </div>
        </div>
      </div>
    </section>

    <!-- Latest Apps -->
    <section class="section">
      <div class="container">
        <div class="section-header">
          <h2 class="section-title">Recently Added</h2>
          <a href="/browse?sort=new" class="section-link">
            View all
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="m9 18 6-6-6-6"/>
            </svg>
          </a>
        </div>

        <div class="grid grid-apps" id="latest-apps">
          <div class="loading" id="latest-loading">
            <div class="loading-spinner"></div>
          </div>
        </div>
      </div>
    </section>

    <!-- Wild West CTA -->
    <section class="section">
      <div class="container">
        <div class="wild-west-banner">
          <div class="wild-west-banner-icon">&#129312;</div>
          <div class="wild-west-banner-content">
            <h2>Explore the Wild West</h2>
            <p>Discover AI-generated apps awaiting community testing. Help shape the future of the Flick Store by testing new apps and providing feedback.</p>
            <a href="/wildwest" class="btn btn-secondary mt-md">Enter Wild West</a>
          </div>
        </div>
      </div>
    </section>
  </main>

  <!-- Footer -->
  <footer class="footer">
    <div class="container">
      <div class="footer-grid">
        <div class="footer-brand">
          <a href="/" class="logo">
            <div class="logo-icon">
              <svg viewBox="0 0 24 24" fill="currentColor">
                <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/>
              </svg>
            </div>
            <span>Flick Store</span>
          </a>
          <p>A fast, modern app store for Flick mobile shell. Discover Qt/QML apps built for touch-first Linux devices.</p>
        </div>

        <div>
          <h4 class="footer-title">Explore</h4>
          <nav class="footer-links">
            <a href="/browse" class="footer-link">Browse Apps</a>
            <a href="/browse?category=games" class="footer-link">Games</a>
            <a href="/browse?category=multimedia" class="footer-link">Multimedia</a>
            <a href="/wildwest" class="footer-link">Wild West</a>
          </nav>
        </div>

        <div>
          <h4 class="footer-title">Community</h4>
          <nav class="footer-links">
            <a href="/request" class="footer-link">Request an App</a>
            <a href="https://github.com/ruapotato/Flick" class="footer-link">GitHub</a>
          </nav>
        </div>

        <div>
          <h4 class="footer-title">Resources</h4>
          <nav class="footer-links">
            <a href="/api" class="footer-link">API</a>
          </nav>
        </div>
      </div>

      <div class="footer-bottom">
        <p class="footer-copyright">&copy; 2025 Flick Project. AGPL-3.0 Licensed.</p>
        <div class="footer-social">
          <a href="https://github.com/ruapotato/Flick" aria-label="GitHub">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
              <path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/>
            </svg>
          </a>
        </div>
      </div>
    </div>
  </footer>

  <script src="/static/js/api.js"></script>
  <script src="/static/js/main.js"></script>
  <script>
    // Category icons mapping
    const categoryIcons = {
      'multimedia': '&#127925;',
      'productivity': '&#128221;',
      'games': '&#127918;',
      'utilities': '&#128295;',
      'internet': '&#127760;',
      'communication': '&#128172;',
      'development': '&#128187;',
      'security': '&#128274;',
      'system': '&#9881;',
    };

    // Get icon for app based on slug or category
    function getAppIcon(slug, category) {
      const iconMap = {
        'music': '&#127925;',
        'ebooks': '&#128214;',
        'audiobooks': '&#127911;',
        'sandbox': '&#127958;',
        'calculator': '&#129518;',
        'calendar': '&#128197;',
        'clock': '&#9200;',
        'contacts': '&#128101;',
        'files': '&#128193;',
        'notes': '&#128221;',
        'weather': '&#127780;',
        'photos': '&#128247;',
        'video': '&#127916;',
        'web': '&#127760;',
        'maps': '&#128506;',
        'podcast': '&#127897;',
        'recorder': '&#127908;',
        'terminal': '&#128187;',
        'settings': '&#9881;',
        'messages': '&#128172;',
        'phone': '&#128222;',
        'email': '&#128231;',
        'passwordsafe': '&#128274;',
        'distract': '&#127918;',
        'welcome': '&#128075;',
        'store': '&#127919;',
      };
      return iconMap[slug] || categoryIcons[category] || '&#128230;';
    }

    function formatDownloads(count) {
      if (count >= 1000000) return (count / 1000000).toFixed(1) + 'M';
      if (count >= 1000) return (count / 1000).toFixed(1) + 'K';
      return count.toString();
    }

    function formatCategoryName(name) {
      if (!name) return '';
      return name.charAt(0).toUpperCase() + name.slice(1).replace(/-/g, ' ');
    }

    function createAppCard(app) {
      const link = document.createElement('a');
      link.href = `/app/${app.slug}`;
      link.className = 'card app-card';
      link.innerHTML = `
        <div class="app-card-image">
          <div class="app-card-icon">${getAppIcon(app.slug, app.category)}</div>
        </div>
        <div class="app-card-content">
          <h3 class="app-card-title">${escapeHtml(app.name)}</h3>
          <p class="app-card-desc">${escapeHtml(app.description.substring(0, 100))}${app.description.length > 100 ? '...' : ''}</p>
          <div class="app-card-meta">
            ${app.average_rating ? `<div class="app-card-rating"><span>&#9733;</span><span>${app.average_rating.toFixed(1)}</span></div>` : ''}
            <span class="app-card-downloads">${formatDownloads(app.download_count)} downloads</span>
            <span class="app-card-category">${escapeHtml(formatCategoryName(app.category))}</span>
          </div>
        </div>
      `;
      return link;
    }

    function createFeaturedSlide(app) {
      const slide = document.createElement('div');
      slide.className = 'carousel-slide';
      slide.innerHTML = `
        <div class="featured-card">
          <div class="featured-content">
            <span class="featured-badge">&#9733; Featured</span>
            <h2 class="featured-title">${escapeHtml(app.name)}</h2>
            <p class="featured-desc">${escapeHtml(app.description)}</p>
            <a href="/app/${app.slug}" class="btn btn-primary">View App</a>
          </div>
          <div class="featured-image">
            <div class="app-card-icon" style="font-size:4rem;">${getAppIcon(app.slug, app.category)}</div>
          </div>
        </div>
      `;
      return slide;
    }

    // Load all dynamic content on the home page
    document.addEventListener('DOMContentLoaded', async () => {
      // Load categories
      const categoriesGrid = document.getElementById('categories-grid');
      const categoriesLoading = document.getElementById('categories-loading');

      try {
        const data = await API.categories.getAll();
        const categories = data.categories || data;

        if (categoriesLoading) categoriesLoading.remove();

        if (Array.isArray(categories) && categories.length > 0) {
          categories.forEach(category => {
            const name = typeof category === 'string' ? category : category.name;
            const count = typeof category === 'object' ? category.count : null;
            const slug = typeof category === 'string' ? category.toLowerCase() : (category.slug || category.name.toLowerCase());

            const link = document.createElement('a');
            link.href = `/browse?category=${encodeURIComponent(slug)}`;
            link.className = 'card category-card';
            link.innerHTML = `
              <div class="category-icon">${categoryIcons[slug] || name.charAt(0).toUpperCase()}</div>
              <span class="category-name">${escapeHtml(formatCategoryName(name))}</span>
              ${count !== null ? `<span class="category-count">${count} apps</span>` : ''}
            `;
            categoriesGrid.appendChild(link);
          });
        } else {
          categoriesGrid.innerHTML = '<p class="text-muted">No categories available</p>';
        }
      } catch (error) {
        console.error('Failed to load categories:', error);
        if (categoriesLoading) categoriesLoading.remove();
        categoriesGrid.innerHTML = '<p class="text-muted">Failed to load categories</p>';
      }

      // Load featured apps (top by downloads)
      const featuredCarousel = document.getElementById('featured-carousel');
      const featuredLoading = document.getElementById('featured-loading');

      try {
        const data = await API.get('/apps', { sort: 'downloads', order: 'desc', per_page: 3 });
        if (featuredLoading) featuredLoading.remove();

        if (data.apps && data.apps.length > 0) {
          data.apps.forEach(app => {
            featuredCarousel.appendChild(createFeaturedSlide(app));
          });
          // Re-initialize carousel
          if (window.initCarousel) window.initCarousel();
        }
      } catch (error) {
        console.error('Failed to load featured apps:', error);
        if (featuredLoading) featuredLoading.remove();
      }

      // Load popular apps
      const popularGrid = document.getElementById('popular-apps');
      const popularLoading = document.getElementById('popular-loading');

      try {
        const data = await API.get('/apps', { sort: 'downloads', order: 'desc', per_page: 4 });
        if (popularLoading) popularLoading.remove();

        if (data.apps && data.apps.length > 0) {
          data.apps.forEach(app => {
            popularGrid.appendChild(createAppCard(app));
          });
        } else {
          popularGrid.innerHTML = '<p class="text-muted">No apps available</p>';
        }
      } catch (error) {
        console.error('Failed to load popular apps:', error);
        if (popularLoading) popularLoading.remove();
        popularGrid.innerHTML = '<p class="text-muted">Failed to load apps</p>';
      }

      // Load latest apps
      const latestGrid = document.getElementById('latest-apps');
      const latestLoading = document.getElementById('latest-loading');

      try {
        const data = await API.get('/apps', { sort: 'created_at', order: 'desc', per_page: 4 });
        if (latestLoading) latestLoading.remove();

        if (data.apps && data.apps.length > 0) {
          data.apps.forEach(app => {
            latestGrid.appendChild(createAppCard(app));
          });
        } else {
          latestGrid.innerHTML = '<p class="text-muted">No apps available</p>';
        }
      } catch (error) {
        console.error('Failed to load latest apps:', error);
        if (latestLoading) latestLoading.remove();
        latestGrid.innerHTML = '<p class="text-muted">Failed to load apps</p>';
      }
    });
  </script>
</body>
</html>
